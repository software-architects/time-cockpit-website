---
layout: blog
title: SQLPASS Session about Windows Azure Table Storage
author: Rainer Stropek
bannerimage: 
permalink: /2013/09/19/SQLPASS-Session-about-Windows-Azure-Table-Storage
---

<p xmlns="http://www.w3.org/1999/xhtml">Today I will do a session in a <a href="http://www.sqlpass.org" target="_blank">SQLPASS</a> community <a href="http://austria.sqlpass.org/" target="_blank">meeting in Vienna</a> about Windows Azure Table Storage. The audience mainly consists of SQL experts and I have been invited to describe similarities and differences of SQL Azure and Table Storage. In this article I want to summarize important links that people who are interested in the details could use. Additionally I publish the source code of the sample that I am going to show.</p><p xmlns="http://www.w3.org/1999/xhtml">Note that the sample is built with the hot and new 2.1 release of Azure's .NET Storage Client. Therefore it can use nice features like async API, building queries with IQueryable, Shared Access Signatures for table storage, etc.</p><p xmlns="http://www.w3.org/1999/xhtml">Here are some photos from the event (click to enlarge). You can view the photos in full resolution <a href="http://www.flickr.com/photos/rainerstropek/" target="_blank">in my Flickr album</a>.</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaFolder" value="MediaArchive:66f02333-7931-4f09-8c07-1d83a71a7531" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="75" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><h2 xmlns="http://www.w3.org/1999/xhtml">The Basics</h2><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>
    <a href="http://www.windowsazure.com/en-us/services/data-management/" target="_blank">Introduction about data management offerings in Windows Azure</a> covering SQL Databases and Table Storage</li>
  <li>
    <a href="http://msdn.microsoft.com/en-us/library/windowsazure/gg433040.aspx" target="_blank">Introduction to Blobs, Tables, and Queues</a> in MSDN</li>
  <li>
    <a href="http://msdn.microsoft.com/en-us/library/windowsazure/dd179338.aspx" target="_blank">The Table Storage Data Model</a> in MSDN</li>
  <li>
    <a href="http://www.windowsazure.com/en-us/develop/net/how-to-guides/table-services/" target="_blank">How to use Table Storage Service in .NET</a> in MSDN</li>
  <li>
    <a href="http://www.nuget.org/packages/WindowsAzure.Storage/" target="_blank">Windows Azure Storage Client Library</a> on NuGet</li>
  <li>
    <a href="http://msdn.microsoft.com/en-us/library/windowsazure/dn261237.aspx" target="_blank">Windows Azure Storage Client Library Reference</a> in MSDN</li>
  <li>Video: Session about table storage I did at a .NET user group meeting last year <iframe width="640" height="360" src="//www.youtube.com/embed/TjRM4L5JKzM?rel=0" frameborder="0" allowfullscreen="allowfullscreen"></iframe></li>
  <li>Windows Azure Training Kit

<ul><li><a href="http://www.microsoft.com/en-us/download/details.aspx?id=8396" target="_blank">Download the Training Kit</a></li><li><a href="http://windowsazure-trainingkit.github.io/labs.htm" target="_blank">Browse the Training Kit online</a></li></ul></li>
</ul><h2 xmlns="http://www.w3.org/1999/xhtml">Pricing</h2><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>
    <a href="http://www.windowsazure.com/en-us/pricing/details/storage/" target="_blank">Windows Azure Storage Pricing</a>
  </li>
  <li>
    <a href="http://www.windowsazure.com/en-us/pricing/details/sql-database/" target="_blank">SQL Database Pricing</a>
  </li>
  <li>
    <a href="http://www.windowsazure.com/en-us/pricing/details/virtual-machines/#service-sql-server" target="_blank">SQL Server Virtual Machine Pricing</a>
  </li>
  <li>
    <a href="http://www.windowsazure.com/en-us/pricing/calculator/?scenario=data-management" target="_blank">Windows Azure Pricing Calculator - Storage</a>
  </li>
</ul><h2 xmlns="http://www.w3.org/1999/xhtml">Deep Dive Content</h2><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>
    <a href="http://msdn.microsoft.com/en-us/library/windowsazure/dd179355.aspx" target="_blank">Windows Azure Storage Services REST API Reference</a> in MSDN</li>
  <li>
    <a href="https://github.com/WindowsAzure/azure-sdk-for-net" target="_blank">Sourcecode of .NET Storage Client Library</a> on github</li>
  <li>
    <a href="http://msdn.microsoft.com/en-us/library/windowsazure/jj554330.aspx" target="_blank">Windows Azure Powershell Cmdlets Reference</a> in MSDN - interesting resource for IT Pros who want to manage tables with Powershell</li>
  <li>
    <a href="http://msdn.microsoft.com/en-us/library/windowsazure/hh343270.aspx" target="_blank">Azure Storage Analytics</a> in MSDN</li>
  <li>
    <a href="http://sigops.org/sosp/sosp11/current/2011-Cascais/printable/11-calder.pdf" target="_blank">Paper describing the internal details of Windows Azure Storage</a>
  </li>
  <li>
    <a href="http://www.youtube.com/watch?v=QnYdbQO0yj4" target="_blank">Video</a> relating to the paper mentioned above</li>
  <li>
    <a href="http://blogs.msdn.com/b/windowsazure/archive/2012/11/02/windows-azure-s-flat-network-storage-and-2012-scalability-targets.aspx" target="_blank">Article about Windows's Azure Flat Network Storage and 2012 Scalability Targets</a> in Azure Team Blog</li>
  <li>
    <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/07/20/windows-azure-storage-4-trillion-objects-and-counting.aspx" target="_blank">Article about data volume and transaction count in Windows Azure</a> in Storage Team Blog</li>
  <li>
    <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/09/07/announcing-storage-client-library-2-1-rtm.aspx" target="_blank">What's new in Storage Client Library 2.1</a> in Storage Team Blog</li>
  <li>
    <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/06/28/windows-azure-storage-build-talk-what-s-coming-best-practices-and-internals.aspx" target="_blank">What's coming in CY13</a> in Storage Team Blog</li>
</ul><h2 xmlns="http://www.w3.org/1999/xhtml">Important 3rd Party Tools</h2><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>
    <a href="http://azurestorageexplorer.codeplex.com/" target="_blank">Azure Storage Explorer</a> on Codeplex - a free tool to interactively manage your Azure Storage Account including tables</li>
  <li>Cerebrata's <a href="http://www.cerebrata.com/" target="_blank">Azure Management Studio</a> - my personal favorite for Azure management</li>
</ul><h2 xmlns="http://www.w3.org/1999/xhtml">Other Related Links</h2><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>
    <a href="http://www.windowsazure.com/" target="_blank">Windows Azure Homepage</a> - this is where you can get your free trial subscription if you want to start playing with it</li>
  <li>
    <a href="https://manage.windowsazure.com" target="_blank">Windows Azure Management Portal</a>
  </li>
  <li>
    <a href="http://www.windowsazure.com/en-us/support/trust-center/" target="_blank">Windows Azure Trust Center</a> - the number one source if you want detailed information about data security and privacy in Windows Azure</li>
</ul><h2 xmlns="http://www.w3.org/1999/xhtml">Source Code of the Sample</h2><f:function name="Composite.Web.Html.SyntaxHighlighter" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="SourceCode" value="using Microsoft.WindowsAzure.Storage;&#xA;using Microsoft.WindowsAzure.Storage.Auth;&#xA;using Microsoft.WindowsAzure.Storage.RetryPolicies;&#xA;using Microsoft.WindowsAzure.Storage.Table;&#xA;using Microsoft.WindowsAzure.Storage.Table.Queryable;&#xA;using System;&#xA;using System.Collections.Generic;&#xA;using System.Configuration;&#xA;using System.Linq;&#xA;using System.Threading.Tasks;&#xA;&#xA;namespace SqlPassTableStorageSample&#xA;{&#xA;    public class Order : TableEntity&#xA;    {&#xA;        public Order()&#xA;        {&#xA;            this.OrderDateTimeUtc = DateTimeOffset.UtcNow;&#xA;        }&#xA;&#xA;        public Order(string partitionKey, string rowKey, DateTimeOffset timestamp, IDictionary&lt;string, EntityProperty&gt; props, string etag)&#xA;            : this()&#xA;        {&#xA;            this.PartitionKey = partitionKey;&#xA;            this.RowKey = rowKey;&#xA;            this.Timestamp = timestamp;&#xA;            this.ETag = etag;&#xA;            this.ReadEntity(props, null);&#xA;        }&#xA;&#xA;        public string CustomerCode { get { return this.PartitionKey; } }&#xA;        public DateTimeOffset OrderDateTimeUtc { get; set; }&#xA;        public int TotalPrice { get; set; }&#xA;        public string EntityType { get { return this.RowKey.Substring(0, 1); } }&#xA;&#xA;        public static string BuildRowKey(string orderId)&#xA;        {&#xA;            // Note that the generated row key for order header starts with the char &quot;O&quot;.&#xA;            // Therefore we can easily filter for all order headers by checking the first&#xA;            // letter of the row key.&#xA;            return string.Format(&quot;O{0}_H&quot;, orderId);&#xA;        }&#xA;    }&#xA;&#xA;    public class OrderLine : TableEntity&#xA;    {&#xA;        public OrderLine()&#xA;        {&#xA;        }&#xA;&#xA;        public OrderLine(string partitionKey, string rowKey, DateTimeOffset timestamp, IDictionary&lt;string, EntityProperty&gt; props, string etag)&#xA;            : this()&#xA;        {&#xA;            this.PartitionKey = partitionKey;&#xA;            this.RowKey = rowKey;&#xA;            this.Timestamp = timestamp;&#xA;            this.ETag = etag;&#xA;            this.ReadEntity(props, null);&#xA;        }&#xA;&#xA;        public string Product { get; set; }&#xA;        public int Amount { get; set; }&#xA;        public int ItemPrice { get; set; }&#xA;        public int TotalPrice { get; set; }&#xA;        public string EntityType { get { return this.RowKey.Substring(0, 1); } }&#xA;&#xA;        public static string BuildRowKey(string orderId, int lineNumber)&#xA;        {&#xA;            // Note that the generated row key for order header starts with the char &quot;L&quot;.&#xA;            // Therefore we can easily filter for all order lines by checking the first&#xA;            // letter of the row key.&#xA;            return string.Format(&quot;L{0}_{1:0000}&quot;, orderId, lineNumber);&#xA;        }&#xA;    }&#xA;&#xA;    class Program&#xA;    {&#xA;        static void Main(string[] args)&#xA;        {&#xA;            // Use the following code to connect to dev storage WITHOUT Fiddler.&#xA;            ////var account = CloudStorageAccount.DevelopmentStorageAccount;&#xA;&#xA;            // Use the following code to connect to dev storage WITH Fiddler.&#xA;            var account = new CloudStorageAccount(&#xA;                new StorageCredentials(&quot;devstoreaccount1&quot;, &quot;Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==&quot;),&#xA;                new Uri(&quot;http://ipv4.fiddler:10000/devstoreaccount1/&quot;, UriKind.Absolute),&#xA;                new Uri(&quot;http://ipv4.fiddler:10001/devstoreaccount1/&quot;, UriKind.Absolute),&#xA;                new Uri(&quot;http://ipv4.fiddler:10002/devstoreaccount1/&quot;, UriKind.Absolute));&#xA;&#xA;            // Use the following code to connect to storage account in the cloud&#xA;            // and read credentials from app.config.&#xA;            ////var credentials = new StorageCredentials(&#xA;            ////    ConfigurationManager.AppSettings[&quot;AccountName&quot;],&#xA;            ////    ConfigurationManager.AppSettings[&quot;AccountPassword&quot;]);&#xA;            ////var account = new CloudStorageAccount(credentials, true);&#xA;            &#xA;            // Create and configure table client &#xA;            var tableClient = account.CreateCloudTableClient();&#xA;            tableClient.RetryPolicy = new ExponentialRetry(TimeSpan.FromSeconds(1), 5);&#xA;&#xA;            // Run demo scenarios&#xA;            ////DropTableAsync(tableClient).Wait();&#xA;            ////CreateTableWithBasicDataManipulationAsync(tableClient).Wait();&#xA;            ////CreateTableWithBatchOperationsAsync(tableClient).Wait();&#xA;            ////QueryScenariosAsync(tableClient).Wait();&#xA;            SharedAccessSignature(tableClient);&#xA;&#xA;            // And now we are done&#xA;            Console.WriteLine(&quot;Done!&quot;);&#xA;            Console.ReadKey();&#xA;        }&#xA;&#xA;        public static async Task DropTableAsync(CloudTableClient tableClient)&#xA;        {&#xA;            Console.WriteLine(&quot;\nScenario: Drop table&quot;);&#xA;&#xA;            var table = tableClient.GetTableReference(&quot;Orders&quot;);&#xA;            if (await table.DeleteIfExistsAsync())&#xA;            {&#xA;                Console.WriteLine(&quot;Table deleted&quot;);&#xA;            }&#xA;        }&#xA;&#xA;        public static async Task CreateTableWithBasicDataManipulationAsync(CloudTableClient tableClient)&#xA;        {&#xA;            Console.WriteLine(&quot;\nScenario: Create table with basic data manipulation&quot;);&#xA;&#xA;            // Create a table.&#xA;            var table = tableClient.GetTableReference(&quot;Orders&quot;);&#xA;            await table.CreateIfNotExistsAsync();&#xA;&#xA;            // Set some demo values&#xA;            var customerCode = &quot;Rainer&quot;;&#xA;            var orderId = Guid.NewGuid().ToString();&#xA;&#xA;            // Add a row with sample data&#xA;            var order = new Order()&#xA;            {&#xA;                PartitionKey = customerCode,                // we partition by customer&#xA;                RowKey = Order.BuildRowKey(orderId),    // guid order number&#xA;                TotalPrice = 100&#xA;            };&#xA;            await table.ExecuteAsync(TableOperation.Insert(order));&#xA;            Console.WriteLine(&quot;New order has been created&quot;);&#xA;&#xA;            // Retrieve a specific row by partition key and row key&#xA;            var result = await table.ExecuteAsync(&#xA;                TableOperation.Retrieve&lt;Order&gt;(customerCode, Order.BuildRowKey(orderId)));&#xA;            var readOrder = (Order)result.Result;           // remember retrieved order, we will &#xA;                                                            // need it later again&#xA;            Console.WriteLine(&quot;Retrieve successful; Order ID = {0}&quot;, readOrder.RowKey);&#xA;&#xA;            // Update a row (this works)&#xA;            order.TotalPrice += 10;&#xA;            await table.ExecuteAsync(TableOperation.Replace(order));&#xA;            Console.WriteLine(&quot;Order has been updated&quot;);&#xA;&#xA;            // Update a row (only works if ETag is specified as shown).&#xA;            // This demos optimistic concurrency. If you do not specify the etag *,&#xA;            // table storage will throw an exception as the underlying data row has&#xA;            // been altered since reading the order in readOrder.&#xA;            readOrder.TotalPrice += 20;&#xA;            readOrder.ETag = order.ETag = &quot;*&quot;;&#xA;            await table.ExecuteAsync(TableOperation.Replace(readOrder));&#xA;&#xA;            // Delete a row&#xA;            await table.ExecuteAsync(TableOperation.Delete(order));&#xA;            Console.WriteLine(&quot;Order has been deleted&quot;);&#xA;        }&#xA;&#xA;        public static async Task CreateTableWithBatchOperationsAsync(CloudTableClient tableClient)&#xA;        {&#xA;            Console.WriteLine(&quot;\nScenario: Create table and execute a batch operation&quot;);&#xA;&#xA;            // Create a table.&#xA;            // Note that we store order headers and order lines in the SAME table.&#xA;            // We even store all order data (headers and lines) or a customer in the&#xA;            // same partition. This makes it fast and easy to retrieve all order data&#xA;            // (headers and lines) of a single customer. Remember: Designing a NoSQL&#xA;            // database is all about designing for certain data access scenarios. Here&#xA;            // we design for a scenario in which it is common to read all order data&#xA;            // for a single customer knowing the customer's code (=partition key).&#xA;            var table = tableClient.GetTableReference(&quot;Orders&quot;);&#xA;            await table.CreateIfNotExistsAsync();&#xA;&#xA;            // Set some demo values&#xA;            var customerCode = &quot;Rainer&quot;;&#xA;            var orderId = Guid.NewGuid().ToString();&#xA;            var totalPrice = 0;&#xA;&#xA;            // Add some order lines. Note that the order lines are not written to the &#xA;            // table immediately. They are collected in a batch operation instead.&#xA;            // Later we can transfer the entire batch in a single REST request to&#xA;            // table storage. That saves money (lower number of transactions) and leads&#xA;            // to better performance (lower latency).&#xA;            var batch = new TableBatchOperation();&#xA;            for (int lineCount = 1; lineCount &lt;= 10; totalPrice += lineCount * 5, lineCount++)&#xA;            {&#xA;                batch.Insert(new OrderLine()&#xA;                {&#xA;                    Product = &quot;Bike&quot;,&#xA;                    Amount = lineCount,&#xA;                    ItemPrice = 5,&#xA;                    TotalPrice = lineCount * 5,&#xA;                    PartitionKey = customerCode,            // we partition by customer&#xA;                    RowKey = OrderLine.BuildRowKey(orderId, lineCount)&#xA;                                                            // build row key from order id and line number&#xA;                });&#xA;            }&#xA;&#xA;            // Add order header&#xA;            batch.Insert(new Order()&#xA;            {&#xA;                TotalPrice = totalPrice,&#xA;                PartitionKey = customerCode,&#xA;                RowKey = Order.BuildRowKey(orderId)&#xA;            });&#xA;&#xA;            // Note that the batch is executed in an atomic transaction&#xA;            await table.ExecuteBatchAsync(batch);&#xA;&#xA;            Console.WriteLine(&quot;New order with order lines has been created&quot;);&#xA;        }&#xA;&#xA;        public static async Task QueryScenariosAsync(CloudTableClient tableClient)&#xA;        {&#xA;            Console.WriteLine(&quot;\nScenario: Querying data (with new IQueryable feature from storage library 2.1)&quot;);&#xA;&#xA;            // Check if table exists&#xA;            var table = tableClient.GetTableReference(&quot;Orders&quot;);&#xA;            if (!await table.ExistsAsync())&#xA;            {&#xA;                return;&#xA;            }&#xA;&#xA;            // Create and execute a simple Linq query. Try running Fiddler to see the&#xA;            // REST requests resulting from that query. You will see that filtering is&#xA;            // done on the server, not on the client. Note that it does NOT&#xA;            // use async API. It blocks the calling thread.&#xA;            (from ol in table.CreateQuery&lt;OrderLine&gt;()&#xA;             where ol.PartitionKey == &quot;Rainer&quot; &#xA;                &amp;&amp; ol.RowKey.CompareTo(&quot;L&quot;) &gt; 0 &amp;&amp; ol.RowKey.CompareTo(&quot;LZ&quot;) &lt; 0&#xA;             select ol)&#xA;                .AsTableQuery()&#xA;                .Execute()&#xA;                .ToList()&#xA;                .ForEach(ol =&gt; Console.WriteLine(&quot;Order Line {0} (Product: '{1}')&quot;, ol.RowKey, ol.Product));&#xA;&#xA;            #region Async segmented query &#xA;            // The following Linq query is executed in segments (i.e. result is delivered in&#xA;            // segments if result set is large). Segmented queries support async execution.&#xA;            var orderQuery = (from o in table.CreateQuery&lt;Order&gt;()&#xA;                              where o.PartitionKey == &quot;Rainer&quot;&#xA;                                &amp;&amp; o.RowKey.CompareTo(&quot;O&quot;) &gt; 0 &amp;&amp; o.RowKey.CompareTo(&quot;OZ&quot;) &lt; 0&#xA;                              select o).AsTableQuery();&#xA;&#xA;            // Loop over all segments&#xA;            var continuationToken = new TableContinuationToken();&#xA;            do&#xA;            {&#xA;                // Get the next segment&#xA;                var segment = await orderQuery.ExecuteSegmentedAsync(continuationToken);&#xA;&#xA;                // Iterate over all items in current segment&#xA;                foreach (var item in segment)&#xA;                {&#xA;                    Console.WriteLine(&quot;Order {0} (Customer: {1})&quot;, item.RowKey, item.CustomerCode);&#xA;                }&#xA;&#xA;                // Store continuation token for retrieving the next segment&#xA;                continuationToken = segment.ContinuationToken;&#xA;            }&#xA;            while (continuationToken != null);&#xA;            #endregion&#xA;&#xA;            // The following query is a dynamic query. It retrieves all order data&#xA;            // (order header and lines) of a customer. The helper function &#xA;            // IterateResultAsync analyzes the result and generates Order or OrderLine&#xA;            // objects depending on the type of entity.&#xA;            var query = table.CreateQuery&lt;DynamicTableEntity&gt;()&#xA;                .Where(e =&gt; e.PartitionKey == &quot;Rainer&quot;)&#xA;                .AsTableQuery();&#xA;            foreach (var item in await IterateResultAsync(query))&#xA;            {&#xA;                Console.WriteLine(&quot;Entity: {0}, CLR Type: {1}&quot;, item.RowKey, item.GetType().Name);&#xA;            }&#xA;        }&#xA;&#xA;        private static async Task&lt;IEnumerable&lt;ITableEntity&gt;&gt; IterateResultAsync(TableQuery&lt;DynamicTableEntity&gt; query)&#xA;        {&#xA;            var result = new List&lt;ITableEntity&gt;();&#xA;            var continuationToken = new TableContinuationToken();&#xA;&#xA;            // Add resolver to query in order to dynamically resolve result type&#xA;            var newQuery = query&#xA;                    .Resolve&lt;DynamicTableEntity, ITableEntity&gt;((pk, rk, ts, props, etag) =&gt;&#xA;                    {&#xA;                        if (rk.StartsWith(&quot;L&quot;))&#xA;                        {&#xA;                            // Generate order line entity&#xA;                            return new OrderLine(pk, rk, ts, props, etag);&#xA;                        }&#xA;                        else&#xA;                        {&#xA;                            // Generate order entity&#xA;                            return new Order(pk, rk, ts, props, etag);&#xA;                        }&#xA;                    });&#xA;&#xA;            // Loop over all segments&#xA;            do&#xA;            {&#xA;                // Get the next segment&#xA;                var segment = await newQuery.ExecuteSegmentedAsync(continuationToken);&#xA;                &#xA;                // Iterate over all items in current segment&#xA;                foreach (var item in segment)&#xA;                {&#xA;                    result.Add(item);&#xA;                }&#xA;&#xA;                // Store continuation token for retrieving the next segment&#xA;                continuationToken = segment.ContinuationToken;&#xA;            }&#xA;            while (continuationToken != null);&#xA;&#xA;            return result;&#xA;        }&#xA;&#xA;        public static void SharedAccessSignature(CloudTableClient tableClient)&#xA;        {&#xA;            Console.WriteLine(&quot;\nScenario: Querying data (with new IQueryable feature from storage library 2.1)&quot;);&#xA;&#xA;            // Check if table exists&#xA;            var table = tableClient.GetTableReference(&quot;Orders&quot;);&#xA;            if (!table.Exists())&#xA;            {&#xA;                return;&#xA;            }&#xA;&#xA;            // Setup a policy that allows querying in the next minute&#xA;            var policy = new SharedAccessTablePolicy()&#xA;            {&#xA;                SharedAccessStartTime = DateTimeOffset.UtcNow,&#xA;                SharedAccessExpiryTime = DateTimeOffset.UtcNow.AddMinutes(1),&#xA;                Permissions = SharedAccessTablePermissions.Query&#xA;            };&#xA;&#xA;            // Limit access to order (not order lines) for customer Rainer&#xA;            var token = table.GetSharedAccessSignature(policy, null, &quot;Rainer&quot;, &quot;O&quot;, &quot;Rainer&quot;, &quot;OZ&quot;);&#xA;            Console.WriteLine(&quot;Token: {0}&quot;, token);&#xA;&#xA;            // Read all order data for customer Rainer -&gt; order lines must not be returned&#xA;            var restrictedClient = new CloudTableClient(&#xA;                tableClient.BaseUri,&#xA;                new StorageCredentials(token));&#xA;            var restrictedTable = restrictedClient.GetTableReference(&quot;Orders&quot;);&#xA;            foreach (var item in restrictedTable.ExecuteQuery(new TableQuery&lt;DynamicTableEntity&gt;())&#xA;                .GroupBy(e =&gt; e.RowKey.Substring(0, 1)))&#xA;            {&#xA;                Console.WriteLine(&quot;Type: {0}, Number of items: {1}&quot;, item.Key, item.Count());&#xA;            }&#xA;        }&#xA;    }&#xA;}" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="CodeType" value="c#" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function>