---
layout: blog
title: BASTA 2013 -  Android Development with Xamarin, C#, and Azure Mobile Services
teaser: The Xamarin and Mono tools enable C# developers to use their existing knowledge and experience to write apps for Android and iOS. At the BASTA 2013 conference I did a session about that topic. During the session I showed a sample that used SQLite on the phone and Windows Azure Mobile Service as its backend in the cloud. In this blog article I publish my slides as well as the sample code.
author: Rainer Stropek
date: 2013-09-24
bannerimage: 
lang: en
permalink: /blog/2013/09/24/BASTA-2013-Android-Development-with-Xamarin-C-and-Azure-Mobile-Services
---

<p xmlns="http://www.w3.org/1999/xhtml">The Xamarin and Mono tools enable C# developers to use their existing knowledge and experience to write apps for Android and iOS. At the BASTA 2013 conference I did a session about that topic. During the session I showed a sample that used SQLite on the phone and <a href="http://www.windowsazure.com/en-us/develop/mobile/" target="_blank">Windows Azure Mobile Services</a> as its backend in the cloud. In this blog article I publish my slides as well as the sample code.</p><h2 xmlns="http://www.w3.org/1999/xhtml">Photos of the Session</h2><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaFolder" value="MediaArchive:71ed5b65-fd3f-4c27-909c-d8055174c109" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="100" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><h2 xmlns="http://www.w3.org/1999/xhtml">Slides</h2><iframe src="http://www.slideshare.net/slideshow/embed_code/26489078?rel=0" width="512" height="421" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen="allowfullscreen" webkitallowfullscreen="webkitallowfullscreen" mozallowfullscreen="mozallowfullscreen" xmlns="http://www.w3.org/1999/xhtml"></iframe><div style="margin-bottom:5px" data-mce-style="margin-bottom: 5px;" xmlns="http://www.w3.org/1999/xhtml">
  <strong>
    <a href="https://de.slideshare.net/rstropek/basta-2013-xamarin-26489078" title="Developing Android and iOS Apps With C#, .NET, Xamarin, Mono, and Windows Azure" target="_blank">Developing Android and iOS Apps With C#, .NET, Xamarin, Mono, and Windows Azure</a>
  </strong> from <strong><a href="http://www.slideshare.net/rstropek" target="_blank">Rainer Stropek</a></strong></div><p xmlns="http://www.w3.org/1999/xhtml">If you prefer PDF, you can <a href="{{site.baseurl}}/content/images/blog/2013/09/BASTA 2013 - Xamarin.pdf" target="_blank">download the slide deck here</a>.</p><h2 xmlns="http://www.w3.org/1999/xhtml">Sourcecode</h2><p xmlns="http://www.w3.org/1999/xhtml">The slidedeck contains a step-by-step description of how to build the sample. However, it does not include the complete sourcecode as I did not write it manually during the session. People who are interested in playing with the sample can <a href="{{site.baseurl}}/content/images/blog/2013/09/BeeBook.MobileAssets.zip" target="_blank">download the source code files</a> here. If you don't want to download the entire sample you can also take a look at the most important pieces of code below. BTW - the sample is about managing honey bee hives. The reason why I have chosen this example is because honey bees are my hobby. If you want to know more you can check out my <a href="http://bienenimgarten.wordpress.com" target="_blank">private blog</a> (German).</p><h3 xmlns="http://www.w3.org/1999/xhtml">Platform-Independent Data Access Layer</h3><p xmlns="http://www.w3.org/1999/xhtml">In my example I wanted to demonstrate the cross-platform usage of ADO.NET (with its <em>Task</em>-based async API) for building a simple data access layer. I wanted my bee hive management app to be offline-enabled. Therefore it uses this layer to access a SQLite database on the phone. However, it could be used e.g. on the server as a data access layer for an web app or web API, too.</p>{% highlight javascript %}using System;&#xA;using System.Collections.Generic;&#xA;using System.ComponentModel.Composition.Hosting;&#xA;using System.Data;&#xA;using System.Data.Common;&#xA;using System.Reflection;&#xA;using System.Threading;&#xA;using System.Threading.Tasks;&#xA;&#xA;namespace BeeBook.Mobile&#xA;{&#xA;&#x9;public abstract class BeeBookDatabase : IDisposable&#xA;&#x9;{&#xA;&#x9;&#x9;private bool disposed = false;&#xA;&#xA;&#x9;&#x9;~BeeBookDatabase()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;this.Dispose(false);&#xA;&#x9;&#x9;&#x9;GC.SuppressFinalize(this);&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;protected DbConnection Connection { get; set; }&#xA;&#xA;&#x9;&#x9;private static BeeBookDatabase current;&#xA;&#x9;&#x9;public static BeeBookDatabase Current &#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;get&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;if (current == null)&#xA;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;// Lazy create and open global database&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;BeeBookDatabase.current = GlobalContainer.Container.GetExportedValue&lt;BeeBookDatabase&gt;();&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;BeeBookDatabase.current.CreateOrOpenDatabaseAsync();&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;return BeeBookDatabase.current;&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public abstract string DatabaseFileLocation { get; }&#xA;&#xA;&#x9;&#x9;public abstract Task CreateOrOpenDatabaseAsync();&#xA;&#xA;&#x9;&#x9;protected abstract string GenerateSqlHiveTableCreate();&#xA;&#x9;&#x9;protected abstract IReadOnlyList&lt;string&gt; GenerateSqlDemoDataInserts();&#xA;&#x9;&#x9;protected virtual string GenerateSqlNumberOfHives()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return &quot;SELECT COUNT(*) FROM Hive;&quot;;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;protected virtual string GenerateSqlGetAllHives()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return &quot;SELECT * FROM Hive;&quot;;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;protected virtual string GenerateSqlGetHiveById(int hiveId)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return string.Format(&quot;SELECT * FROM Hive WHERE Id = {0};&quot;, hiveId);&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public async Task CreateOrUpdateSchema()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;using (var command = this.Connection.CreateCommand())&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;command.CommandText = this.GenerateSqlHiveTableCreate();&#xA;&#x9;&#x9;&#x9;&#x9;command.CommandType = CommandType.Text;&#xA;&#x9;&#x9;&#x9;&#x9;await command.ExecuteNonQueryAsync();&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public async Task GenerateDemodata()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;using (var command = this.Connection.CreateCommand())&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;command.CommandType = CommandType.Text;&#xA;&#x9;&#x9;&#x9;&#x9;command.CommandText = this.GenerateSqlNumberOfHives();&#xA;&#x9;&#x9;&#x9;&#x9;var numberOfHives = (long)await command.ExecuteScalarAsync();&#xA;&#x9;&#x9;&#x9;&#x9;if (numberOfHives == 0)&#xA;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;foreach (var stmt in this.GenerateSqlDemoDataInserts())&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;command.CommandText = stmt;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;await command.ExecuteNonQueryAsync();&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public async Task&lt;IReadOnlyList&lt;Hive&gt;&gt; GetAllHives()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;var result = new List&lt;Hive&gt;();&#xA;&#x9;&#x9;&#x9;using (var command = this.Connection.CreateCommand())&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;command.CommandType = CommandType.Text;&#xA;&#x9;&#x9;&#x9;&#x9;command.CommandText = this.GenerateSqlGetAllHives();&#xA;&#x9;&#x9;&#x9;&#x9;using (var reader = await command.ExecuteReaderAsync())&#xA;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;var idOrdinal = reader.GetOrdinal(&quot;Id&quot;);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;var hiveNameOrdinal = reader.GetOrdinal(&quot;hiveName&quot;);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;var latOrdinal  = reader.GetOrdinal(&quot;lat&quot;);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;var longOrdinal = reader.GetOrdinal(&quot;long&quot;);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;while (await reader.ReadAsync())&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;result.Add(new Hive()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Id = (int)reader.GetInt64(idOrdinal),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;HiveName = reader.GetString(hiveNameOrdinal),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Lat = reader.GetDouble(latOrdinal),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Long = reader.GetDouble(longOrdinal)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;});&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;&#x9;return result;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;public async Task&lt;Hive&gt; GetHiveById(int hiveId)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Hive result = null;&#xA;&#x9;&#x9;&#x9;using (var command = this.Connection.CreateCommand())&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;command.CommandType = CommandType.Text;&#xA;&#x9;&#x9;&#x9;&#x9;command.CommandText = this.GenerateSqlGetHiveById(hiveId);&#xA;&#x9;&#x9;&#x9;&#x9;using (var reader = await command.ExecuteReaderAsync())&#xA;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;if (await reader.ReadAsync())&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var idOrdinal = reader.GetOrdinal(&quot;Id&quot;);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var hiveNameOrdinal = reader.GetOrdinal(&quot;hiveName&quot;);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var latOrdinal = reader.GetOrdinal(&quot;lat&quot;);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var longOrdinal = reader.GetOrdinal(&quot;long&quot;);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;result = new Hive()&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Id = reader.GetInt32(idOrdinal),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;HiveName = reader.GetString(hiveNameOrdinal),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Lat = reader.GetDouble(latOrdinal),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Long = reader.GetDouble(longOrdinal)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;};&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;&#x9;return result;&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public void CloseDatabase()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;this.CheckDisposed();&#xA;&#xA;&#x9;&#x9;&#x9;if (this.Connection != null)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;this.Connection.Close();&#xA;&#x9;&#x9;&#x9;&#x9;this.Connection.Dispose();&#xA;&#x9;&#x9;&#x9;&#x9;this.Connection = null;&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public void Dispose()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;this.Dispose(true);&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public void Dispose(bool disposing)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;if (disposing)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;this.CloseDatabase();&#xA;&#x9;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;&#x9;this.disposed = true;&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;protected void CheckDisposed()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;if (this.disposed)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;throw new ObjectDisposedException(this.ToString());&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight %}<p xmlns="http://www.w3.org/1999/xhtml">And this is the sample implementation (derived from the class above) for SQLite on the Android phone.</p>{% highlight javascript %}using System;&#xA;using System.IO;&#xA;using System.Threading;&#xA;using System.Threading.Tasks;&#xA;using Mono.Data.Sqlite;&#xA;using System.ComponentModel.Composition;&#xA;using System.Collections.Generic;&#xA;&#xA;namespace BeeBook.Mobile&#xA;{&#xA;&#x9;[Export(typeof(BeeBookDatabase))]&#xA;&#x9;[PartCreationPolicy(CreationPolicy.Shared)]&#xA;&#x9;public class BeeBookDatabaseMobile : BeeBookDatabase&#xA;&#x9;{&#xA;&#x9;&#x9;public override string DatabaseFileLocation&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;get&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;this.CheckDisposed();&#xA;&#x9;&#x9;&#x9;&#x9;return Path.Combine(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;System.Environment.GetFolderPath(System.Environment.SpecialFolder.Personal),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&quot;hives.db3&quot;);&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public override async Task CreateOrOpenDatabaseAsync()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;this.CheckDisposed();&#xA;&#xA;&#x9;&#x9;&#x9;// If database is already open, close it&#xA;&#x9;&#x9;&#x9;if (this.Connection != null)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;this.CloseDatabase();&#xA;&#x9;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;&#x9;// Create database file if it does not exist&#xA;&#x9;&#x9;&#x9;var dbFileName = this.DatabaseFileLocation;&#xA;&#x9;&#x9;&#x9;if (!File.Exists(dbFileName))&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;SqliteConnection.CreateFile(dbFileName);&#xA;&#x9;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;&#x9;// Create connection and open it async&#xA;&#x9;&#x9;&#x9;this.Connection = new SqliteConnection(string.Format(&quot;Data Source={0}&quot;, this.DatabaseFileLocation));&#xA;&#x9;&#x9;&#x9;await this.Connection.OpenAsync();&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;protected override string GenerateSqlHiveTableCreate()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return &quot;CREATE TABLE IF NOT EXISTS Hive ( Id INTEGER CONSTRAINT PK_Hive PRIMARY KEY ASC AUTOINCREMENT, hiveName TEXT, lat REAL, long REAL );&quot;;&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;protected override IReadOnlyList&lt;string&gt; GenerateSqlDemoDataInserts()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return new[] {&#xA;&#x9;&#x9;&#x9;&#x9;&quot;INSERT INTO Hive ( hiveName, lat, long ) values ( 'Nähe Rapsfeld', 48.279381, 14.239203 )&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&quot;INSERT INTO Hive ( hiveName, lat, long ) values ( 'Kürnbergerwald', 48.285819, 14.2355 )&quot;&#xA;&#x9;&#x9;&#x9;};&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;protected override string GenerateSqlNumberOfHives()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return &quot;SELECT COUNT(*) FROM Hive;&quot;;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;protected override string GenerateSqlGetAllHives()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return &quot;SELECT * FROM Hive;&quot;;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;protected override string GenerateSqlGetHiveById(int hiveId)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return string.Format(&quot;SELECT * FROM Hive WHERE Id = {0};&quot;, hiveId);&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;}&#xA;}{% endhighlight %}<h3 xmlns="http://www.w3.org/1999/xhtml">Adapter (Data Source for <em>ListView</em>)</h3><p xmlns="http://www.w3.org/1999/xhtml">The Data Access Layer is used by an adapter which acts as the data source for the main activity:</p>{% highlight javascript %}using Android.Content;&#xA;using Android.Views;&#xA;using Android.Widget;&#xA;using BeeHive.Mobile;&#xA;using System.Collections.Generic;&#xA;&#xA;namespace BeeBook.Mobile&#xA;{&#xA;&#x9;public class HiveAdapter : BaseAdapter&lt;Hive&gt;&#xA;&#x9;{&#xA;&#x9;&#x9;private IReadOnlyList&lt;Hive&gt; items = new List&lt;Hive&gt;();&#xA;&#x9;&#x9;private readonly LayoutInflater inflater;&#xA;&#xA;&#x9;&#x9;public HiveAdapter(Context context)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;this.inflater = (LayoutInflater)context.GetSystemService(Context.LayoutInflaterService);&#xA;&#x9;&#x9;&#x9;this.RefreshAsync();&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public override bool HasStableIds { get { return true; } }&#xA;&#x9;&#x9;public override int Count { get { return this.items.Count; } }&#xA;&#x9;&#x9;public override Hive this[int position] { get { return this.items[position]; } }&#xA;&#x9;&#x9;public override long GetItemId(int position) { return this.items[position].Id; }&#xA;&#xA;&#x9;&#x9;public override View GetView(int position, View convertView, ViewGroup parent)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;var item = this.items[position];&#xA;&#xA;&#x9;&#x9;&#x9;var view = this.inflater.Inflate(Resource.Layout.HiveItem, null);&#xA;&#x9;&#x9;&#x9;var itemTextView = view.FindViewById&lt;TextView&gt;(Resource.Id.ItemText);&#xA;&#x9;&#x9;&#x9;itemTextView.Text = item.HiveName;&#xA;&#xA;&#x9;&#x9;&#x9;itemTextView.Click += (o, e) =&gt;&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;var hiveDetailsActivity = new Intent(this.inflater.Context, typeof(HiveDetails));&#xA;&#x9;&#x9;&#x9;&#x9;hiveDetailsActivity.PutExtra(&quot;Id&quot;, item.Id);&#xA;&#x9;&#x9;&#x9;&#x9;this.inflater.Context.StartActivity(hiveDetailsActivity);&#xA;&#x9;&#x9;&#x9;};&#xA;&#xA;&#x9;&#x9;&#x9;return view;&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public async void RefreshAsync()&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;this.items = await BeeBookDatabase.Current.GetAllHives();&#xA;&#x9;&#x9;&#x9;this.NotifyDataSetChanged();&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight %}<h3 xmlns="http://www.w3.org/1999/xhtml">Main Activity</h3><p xmlns="http://www.w3.org/1999/xhtml">The main activity simply displays a list of bee hives. The data is read from the adapter shown above. Note that the main activity uses an action bar menu item to display a <em>Sync</em> option. If the user clicks on this menu item, the data from the phone's SQLite database is transferred into the cloud using Windows Azure Mobile Services.</p>{% highlight javascript %}using Android.App;&#xA;using Android.OS;&#xA;using Android.Views;&#xA;using BeeBook.Mobile;&#xA;using Microsoft.WindowsAzure.MobileServices;&#xA;using System.Linq;&#xA;using System.Threading.Tasks;&#xA;&#xA;namespace BeeHive.Mobile&#xA;{&#xA;&#x9;[Activity(Label = &quot;BeeHive.Mobile&quot;, MainLauncher = true)]&#xA;&#x9;public class MainActivity : ListActivity&#xA;&#x9;{&#xA;&#x9;&#x9;private static readonly MobileServiceClient MobileService =&#xA;&#x9;&#x9;&#x9;new MobileServiceClient(&quot;https://myaccount.azure-mobile.net/&quot;, &quot;mykey&quot;);&#xA;&#xA;&#x9;&#x9;protected override async void OnCreate(Bundle bundle)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;base.OnCreate(bundle);&#xA;&#xA;&#x9;&#x9;&#x9;// Activate the action bar&#xA;&#x9;&#x9;&#x9;this.RequestWindowFeature(WindowFeatures.ActionBar);&#xA;&#xA;&#x9;&#x9;&#x9;var db = BeeBookDatabase.Current;&#xA;&#x9;&#x9;&#x9;await db.CreateOrUpdateSchema();&#xA;&#x9;&#x9;&#x9;await db.GenerateDemodata();&#xA;&#xA;&#x9;&#x9;&#x9;this.ListAdapter = new HiveAdapter(this);&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public override bool OnCreateOptionsMenu(Android.Views.IMenu menu)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;var inflater = this.MenuInflater;&#xA;&#x9;&#x9;&#x9;inflater.Inflate(Resource.Menu.MainMenu, menu);&#xA;&#x9;&#x9;&#x9;return true;&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public override bool OnOptionsItemSelected(IMenuItem item)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;if (item.ItemId == Resource.Id.menu_sync)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;Task.Run(async () =&gt;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var hivesInLocalDb = await BeeBookDatabase.Current.GetAllHives();&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var table = MainActivity.MobileService.GetTable&lt;Hive&gt;();&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var hivesInRemoteDb = await table.ToListAsync();&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;foreach (var missingHive in hivesInLocalDb.Where(h =&gt; hivesInRemoteDb.Count(hRemote =&gt; hRemote.HiveName == h.HiveName) == 0).ToArray())&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;missingHive.Id = 0;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;await table.InsertAsync(missingHive);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;});&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;return true;&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;return base.OnOptionsItemSelected(item);&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight %}<h3 xmlns="http://www.w3.org/1999/xhtml">Hive Details With Google M{% highlight javascript %}using Android.App;&#xA;using Android.OS;&#xA;using Android.Views;&#xA;using BeeBook.Mobile;&#xA;using Microsoft.WindowsAzure.MobileServices;&#xA;using System.Linq;&#xA;using System.Threading.Tasks;&#xA;&#xA;namespace BeeHive.Mobile&#xA;{&#xA;&#x9;[Activity(Label = &quot;BeeHive.Mobile&quot;, MainLauncher = true)]&#xA;&#x9;public class MainActivity : ListActivity&#xA;&#x9;{&#xA;&#x9;&#x9;private static readonly MobileServiceClient MobileService =&#xA;&#x9;&#x9;&#x9;new MobileServiceClient(&quot;https://youraccount.azure-mobile.net/&quot;, &quot;yourkey&quot;);&#xA;&#xA;&#x9;&#x9;protected override async void OnCreate(Bundle bundle)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;base.OnCreate(bundle);&#xA;&#xA;&#x9;&#x9;&#x9;// Activate the action bar&#xA;&#x9;&#x9;&#x9;this.RequestWindowFeature(WindowFeatures.ActionBar);&#xA;&#xA;&#x9;&#x9;&#x9;var db = BeeBookDatabase.Current;&#xA;&#x9;&#x9;&#x9;await db.CreateOrUpdateSchema();&#xA;&#x9;&#x9;&#x9;await db.GenerateDemodata();&#xA;&#xA;&#x9;&#x9;&#x9;this.ListAdapter = new HiveAdapter(this);&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public override bool OnCreateOptionsMenu(Android.Views.IMenu menu)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;var inflater = this.MenuInflater;&#xA;&#x9;&#x9;&#x9;inflater.Inflate(Resource.Menu.MainMenu, menu);&#xA;&#x9;&#x9;&#x9;return true;&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;public override bool OnOptionsItemSelected(IMenuItem item)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;if (item.ItemId == Resource.Id.menu_sync)&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;Task.Run(async () =&gt;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var hivesInLocalDb = await BeeBookDatabase.Current.GetAllHives();&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var table = MainActivity.MobileService.GetTable&lt;Hive&gt;();&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var hivesInRemoteDb = await table.ToListAsync();&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;foreach (var missingHive in hivesInLocalDb.Where(h =&gt; hivesInRemoteDb.Count(hRemote =&gt; hRemote.HiveName == h.HiveName) == 0).ToArray())&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;missingHive.Id = 0;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;await table.InsertAsync(missingHive);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;});&#xA;&#xA;&#x9;&#x9;&#x9;&#x9;return true;&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;return base.OnOptionsItemSelected(item);&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight %}aps Activation</h3><p xmlns="http://www.w3.org/1999/xhtml">If a user clicks on a bee hive row in the main activity's <em>ListView</em>, the hive's details are displayed. The detail form contains a butten which should show the location of the bee hive in Google maps. Here is the code for the hive detail activity:</p>{% highlight javascript %}using Android.App;&#xA;using Android.Content;&#xA;using Android.OS;&#xA;using Android.Widget;&#xA;using BeeHive.Mobile;&#xA;&#xA;namespace BeeBook.Mobile&#xA;{&#xA;&#x9;[Activity(Label = &quot;Hive Details&quot;)]&#xA;&#x9;public class HiveDetails : Activity&#xA;&#x9;{&#xA;&#x9;&#x9;protected override async void OnCreate(Bundle bundle)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;base.OnCreate(bundle);&#xA;&#x9;&#x9;&#x9;this.SetContentView(Resource.Layout.HiveDetails);&#xA;&#xA;&#x9;&#x9;&#x9;var hiveId = this.Intent.GetIntExtra(&quot;Id&quot;, -1);&#xA;&#x9;&#x9;&#x9;if (hiveId != (-1))&#xA;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;var hive = await BeeBookDatabase.Current.GetHiveById(hiveId);&#xA;&#x9;&#x9;&#x9;&#x9;if (hive != null)&#xA;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;this.FindViewById&lt;EditText&gt;(Resource.Id.HiveNameText).Text = hive.HiveName;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;this.FindViewById&lt;EditText&gt;(Resource.Id.LongitudeText).Text = hive.Long.ToString();&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;this.FindViewById&lt;EditText&gt;(Resource.Id.LatitudeText).Text = hive.Lat.ToString();&#xA;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;this.FindViewById&lt;Button&gt;(Resource.Id.DisplayLocation).Click += (s, e) =&gt;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var uriString = string.Format(&quot;https://maps.google.com/maps?q=loc:{0}+{1}&quot;, hive.Lat, hive.Long);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var uri = Android.Net.Uri.Parse(uriString);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;var intent = new Intent(Intent.ActionView, uri);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;this.StartActivity(intent);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;};&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight %}