---
layout: blog
title: Importer Improvements
teaser: Out of the box time cockpit ships with a powerful importer that can import both CSV and Microsoft Excel files. In previous versions the importer could only be used to import new records. In the new version February 2014 we have improved the importer to also support updating existing records.
author: Alexander Huber
date: 2014-01-28
bannerimage: 
lang: en
permalink: /blog/2014/01/28/Importer-Improvements
---

<p xmlns="http://www.w3.org/1999/xhtml">Out of the box time cockpit ships with a powerful importer that can import both CSV and Microsoft Excel files. In previous versions the importer could only be used to import new records. In the new version February 2014 we have improved the importer to also support updating existing records. In this blog post I would like to show you how to comfortably edit records with Microsoft Excel and afterwards use the importer to bulk update the edited records in time cockpit.</p><h2 xmlns="http://www.w3.org/1999/xhtml">Scenario</h2><p xmlns="http://www.w3.org/1999/xhtml">In our scenario we have various projects that are billable but do not have a project budget assigned. These projects are time and material projects so they are billed at cost. However, to perform at rudimentary project controlling, we want to assign a cost cap for each project that is missing a project budget. That way, we could for example use the <em>Budgetary Control</em> list in time cockpit to keep track of the effort that has already been spent on a project. Further, we could implement a notification mechanism if a project is likely to exceed its budget (see <a href="~/blog/2012/11/23/Get-Notified-When-a-Project-is-Exceeding-Its-Budget" target="_blank" title="How to get an email notification in time cockpit when a projects exceeds its budget">Get Notified When a Project is Exceeding Its Budget</a>).</p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Budgetary Control" src="{{site.baseurl}}/content/images/blog/2014/01/BudgetControl.png" alt="Budgetary Control" />
</p><p xmlns="http://www.w3.org/1999/xhtml">Agreed, this is a rather simple scenario. But imagine you need to consolidate a large amount of data over a number of people. You might want to send out a spreadsheet with the data to consolidate to your colleagues and reimport the changes as a bulk.</p><h2 xmlns="http://www.w3.org/1999/xhtml">Exporting Data</h2><p xmlns="http://www.w3.org/1999/xhtml">First, we need to export the data we want to edit in Microsoft Excel from time cockpit. There are multiple ways to export data in Excel format. For one, you can use <em>Excel export</em> in the ribbon to export a list as-is in Excel. Another option is to use the <em>Print</em> feature which was introduced in the October version of time cockpit. The print feature is much more sophisticated in terms of options you can choose. For our scenario, we use the <em>Quick excel export</em>. For further detail on the Excel export see <a href="~/blog/2012/09/30/Reporting-with-time-cockpit-and-Microsoft-Office-Excel" target="_blank" title="Reporting with time cockpit and Microsoft Excel">Reporting with time cockpit and Microsoft Excel</a>. </p><p class="showcase" xmlns="http://www.w3.org/1999/xhtml">To be able to update existing time cockpit records via the importer, make sure to export a unique key for a record. In our case the unique key is the <em>Project Code</em>. This unique key is used to identify existing records and update them accordingly.</p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Quick Excel Export" src="{{site.baseurl}}/content/images/blog/2014/01/Quick excel export.png" alt="Quick Excel Export" />
</p><h2 xmlns="http://www.w3.org/1999/xhtml">Creating an Import Definition</h2><p xmlns="http://www.w3.org/1999/xhtml">To import records from either CSV or Microsoft Excel, you can create so called <strong>import definitions</strong> that map the columns from a file (CSV or Excel) to properties or relations of a time cockpit record. You can find a detailed description on how the importer works at <a href="~/blog/2012/09/30/Reporting-with-time-cockpit-and-Microsoft-Office-Excel">http://www.timecockpit.com/blog/2012/09/30/Reporting-with-time-cockpit-and-Microsoft-Office-Excel</a>. In this blog post I only want to cover the new feature of updating existing records with the importer.</p><p xmlns="http://www.w3.org/1999/xhtml">Having used the <em>Quick excel export</em> feature to export all our project records from time cockpit into an Excel spreadsheet, we can take a look at the generated file. The excel file should contain all the project records in a worksheet called <em>Projects</em>. To spare yourself as much work as possible you would like to rename the worksheet from <em>Projects</em> to <em>Project</em>. This way, the importer knows that you are about to import Project records and is able to generate most of the import definition itself saving you time and effort.</p><p xmlns="http://www.w3.org/1999/xhtml">In the excel file, we assign cost caps to all the project records that have no project budget yet. The new project budget represents the change the importer should apply on the existing project records in time cockpit.</p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Rename Worksheet" src="{{site.baseurl}}/content/images/blog/2014/01/Rename Worksheet.png" alt="Rename Worksheet" />
</p><p xmlns="http://www.w3.org/1999/xhtml">Now it is time to create a import definition. Since we are updating project, we called our import definition <em>Project Update</em>. Afterwards, we provide a sample file for the import definition. In our sample we use the exported and modified project Excel file as sample file. Click <em>Load sample file</em> and choose the file where you have made your adaptions. You will notice that the importer will automatically find <em>Project</em> as the target entity for the import (see <em>Worksheets</em> grid). </p><p class="showcase" xmlns="http://www.w3.org/1999/xhtml">If you sample file is very large it may decrease the performance of the <em>Import Definitions</em> list. In this case it would be better to provide a sample file with only a few records. The sample file is not used to import the data from that file. It is only used to map the columns from the Excel to properties in time cockpit.</p><p xmlns="http://www.w3.org/1999/xhtml">Next, we try to automatically generate a mapping from the column names in the Excel file to property/relation names in time cockpit. By clicking <em>Generate mapping automatically</em>, time cockpit will try to create a mapping suggestion in the <em>Columns</em> grid. You will notice two highlighted rows the importer is not able to map automatically, <em>Filter</em> and <em>True</em>. These two columns represent the filter criteria that were used during the export. You can safely remove the column mappings using the "-" button at the bottom of the <em>Columns</em> grid.</p><p xmlns="http://www.w3.org/1999/xhtml">To enable the importer to update existing items in time cockpit it has to know which columns is used as key. In our sample this is the <em>Project Code</em>. Open the <em>Advanced Settings</em> hyperlink and check the <em>Is Key</em> checkbox for the <em>Project Code</em> column. Whenever the importer finds an existing item with a matching key it updates the record with the given key instead of creating a new one.</p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Advanced Settings" src="{{site.baseurl}}/content/images/blog/2014/01/Advanced Settings.png" alt="Advanced Settings" />
</p><p xmlns="http://www.w3.org/1999/xhtml">In the <em>Advanced Settings</em> dialog you can also set the following properties:</p><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>Is Optional: This setting determines whether import errors raised by this column are ignored.</li>
  <li>Pre-processing Formula: The pre-processing formula describes a transformation formula that is applied on an item. You can access the value from the Excel via the <em>@SourceValue</em> parameter.</li>
  <li>Post-processing Formula: The post-processing formula is executed after the pre-processing formula has been applied and the object has been filled with all values of the currently processed record.</li>
</ul><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Set Is Key" src="{{site.baseurl}}/content/images/blog/2014/01/SetIsKey.png" alt="Set Is Key" />
</p><p xmlns="http://www.w3.org/1999/xhtml">Using a pre-processing formula or a post-processing formula enables you to perform transformations before storing a record to the time cockit database. In our example we want to add a time stamp to the project name property of each project record to see when the record has been altered. The formula for this pre-processing transformation would be <em>@SourceValue + ' (' + :Today() + ')'</em>. The processing formulas are written in <a href="http://help.timecockpit.com/?topic=html/28e3e0bd-6bd7-4435-930b-69671817bf95.htm" target="_blank">TCQL</a> which is used throughout time cockpit. The special parameter <em>@SourceValue</em> lets you access the value of a column, in this case <em>Project Name</em>. </p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Pre-processing Formula" src="{{site.baseurl}}/content/images/blog/2014/01/Pre-processing.png" alt="Pre-processing Formula" />
</p><p xmlns="http://www.w3.org/1999/xhtml">The post-processing formula is used after all the values of a project record in the spreadsheet are transferred to an object that can be saved by time cockpit (a.k.a <a href="http://help.timecockpit.com/?topic=html/dfbc3e13-f897-51fd-b343-445a00f695b8.htm" target="_blank">EntityObject</a>). In the post-processing formula you can perform additional transformations. In contrast to the pre-processing formula where you have only the value of the current column (<em>@SourceValue</em>), in the post-processing formula you can access all properties of the given object by using <em>Current.PropertyName</em>. If you would like to prepend the project code to the project name, you could define the formula <em>Current.ProjectCode + '.' + Current.ProjectName</em>. </p><p xmlns="http://www.w3.org/1999/xhtml">Now we have mapped all the necessary fields and can save the import definition. </p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Import Definition" src="{{site.baseurl}}/content/images/blog/2014/01/Project Update Def.png" alt="Import Definition" />
</p><p xmlns="http://www.w3.org/1999/xhtml">
  <span style="color: rgb(37, 160, 218); font-size: 20px; line-height: 20px;">Import Data</span>
  <br />
</p><p xmlns="http://www.w3.org/1999/xhtml">To start an import click <em>Import</em> in the import definitions list. In the upcoming dialog choose the file you want to import. Again, we choose the file that we have updated in Microsoft Excel. In this case, the file serves two purposes. First, it defines the format and structure how an Excel file needs to look like so that the importer can use it with a given import definition. Second, the file also holds the data that is going to be imported. Of course, you can import any file holding project records that fits the import definition we have just created. </p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Select Source File" src="{{site.baseurl}}/content/images/blog/2014/01/Start Import.png" alt="Select Source File" />
</p><p xmlns="http://www.w3.org/1999/xhtml">Click <em>Select source file</em> and select the file containing the project records you want to import. To make sure that the import will succeed you can click <em>Test Import</em> first, to see if the records would successfully be imported. If not, the importer will give you detailed information about what went wrong in the <em>Error messages</em> grid.</p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Error Messages" src="{{site.baseurl}}/content/images/blog/2014/01/Errors.png" alt="Error Messages" />
</p><p xmlns="http://www.w3.org/1999/xhtml">In this scenario there exist two project records in time cockpit with the same code. Since the project code should be unique, this is an error in our master data that can be corrected by assigning each project a unique project code. Testing the import again with corrected master data, the test import completes successfully and we can <em>Execute import</em> to persist the bulk updates made in Excel.</p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Import Succeeded" src="{{site.baseurl}}/content/images/blog/2014/01/Import Succeeded.png" alt="Import Succeeded" />
</p><p xmlns="http://www.w3.org/1999/xhtml">As you can see from the above dialog, the importer did not create any new records, but only updated existing ones. This is because the importer found for all project codes in the Excel file a corresponding project record in time cockpit. If the importer did not find a record, it would have created a new project record in time cockpit. The following screenshot shows the result of the import for one single record. Please note that the project budget and the project name has been updated. The budget was edited directly in Excel. The project name resulted from the transformation defined in the pre-processing formula.</p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Updated Record" src="{{site.baseurl}}/content/images/blog/2014/01/Updated Record.png" alt="Updated Record" />
</p><h2 xmlns="http://www.w3.org/1999/xhtml">Summary</h2><p xmlns="http://www.w3.org/1999/xhtml">In this blog post we showed how to use the new update feature of time cockpit's built-in importer to perform a bulk update for externally edited data. For the update to work, it is necessary to provide a column in the file to import (Excel or CSV) that represents a unique key for a record. This key is used to <span lang="EN-US">identify</span> an existing record in time cockpit to decide whether to update a record or insert a new one instead. Although this scenario presented was quite simple, I hope you got an idea of how to use the new importer feature to your advance.</p><h2 xmlns="http://www.w3.org/1999/xhtml">Further Reading</h2><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>
    <a href="http://help.timecockpit.com/?topic=html/77e1bfc5-2e00-4348-9208-cba65638f3b5.htm" target="_blank" title="Export data from time cockpit in Excel">Excel Exporter</a>
    <br />
  </li>
  <li>
    <a href="http://help.timecockpit.com/?topic=html/ee560e49-e503-4d80-9167-2e6533f50dbe.htm" target="_blank" title="Import data from Excel to time cockpit">Excel Importer</a>
    <br />
  </li>
  <li>
    <a href="~/blog/2012/09/30/Reporting-with-time-cockpit-and-Microsoft-Office-Excel" title="Reporting with time cockpit and Microsoft Office Excel">Reporting with Excel</a>
    <br />
  </li>
  <li>
    <a href="~/blog/2013/11/27/Reporting-Preview-Improvements" title="Get printable reports in time cockpit">Printable Reports</a>
    <br />
  </li>
</ul>