---
layout: blog
title: 10 OData FAQs
author: Rainer Stropek
bannerimage: 
permalink: /2014/09/12/10-OData-FAQs
---

<p xmlns="http://www.w3.org/1999/xhtml">I have been speaking about <a href="http://www.odata.org" target="_blank">OData</a> at conferences for many years now. As a database guy, the standard fascinated me from the first day on. It perfectly combines the flexibility that SQL offers in the RDBMS-world with modern web and cloud technologies.</p><p xmlns="http://www.w3.org/1999/xhtml">Today will have another talk about OData at <a href="http://www.nrwconf.de/" target="_blank">NRWConf</a> conference in Wuppertal, Germany. It will be a 100% code-only talk so I thought it might be useful to provide some of the information I will cover in my session in a blog article. However, I have written quite some OData-related articles in my blog before. So this one has to be a bit different. I decided to write in in a FAQ style and answer some questions I regularly get when talking with people about OData.</p><p class="showcase" xmlns="http://www.w3.org/1999/xhtml">You can find the entire source code <a href="https://github.com/rstropek/Samples/tree/master/ODataFaq" target="_blank">in my GitHub repository</a>. Feel free to download it, follow along, or just experiment with the code.</p><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>
    <a href="#TheSample">Description of the sample used in this article</a>
  </li>
</ul><ol xmlns="http://www.w3.org/1999/xhtml">
  <li>
    <a href="#WhyOData">Why OData and not just plain web API?</a>
  </li>
  <li>
    <a href="#Metadata">What about metadata?</a>
  </li>
  <li>
    <a href="#GenerateClient">Can I generate C# proxy code for OData services?</a>
  </li>
  <li>
    <a href="#Functions">Is there something like stored procedures or functions to encapsulate logic?</a>
  </li>
  <li>
    <a href="#QueryOptions">Can I restrict users so that they can only use certain query options?</a>
  </li>
  <li>
    <a href="#WCFDataServices">How does ASP.NET Web API relate to WCF Data Services?</a>
  </li>
  <li>
    <a href="#ODataLib">Can I still use OData if I don't use Entity Framework?</a>
  </li>
  <li>
    <a href="#Support">Is OData already supported by major tool vendors?</a>
  </li>
  <li>
    <a href="#Writing">Is OData just for reading data?</a>
  </li>
  <li>
    <a href="#Auth">What about authentication and authorization?</a>
  </li>
</ol><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="TheSample" name="TheSample" class="mce-item-anchor"></a>The Sample</h2><p xmlns="http://www.w3.org/1999/xhtml">I would like to demonstrate different aspects of OData based on a simple but not trivial example. Here is the class diagram for the sample. It consists of the classical <em>customers - order header - order details - products</em> data structure.</p><p xmlns="http://www.w3.org/1999/xhtml">
  <f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
    <f:param name="MediaImage" value="MediaArchive:f4b33a8e-6c2a-425d-89c5-be4c3a06f175" xmlns:f="http://www.composite.net/ns/function/1.0" />
    <f:param name="ThumbnailMaxWidth" value="600" xmlns:f="http://www.composite.net/ns/function/1.0" />
    <f:param name="ThumbnailMaxHeight" value="600" xmlns:f="http://www.composite.net/ns/function/1.0" />
    <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
    <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
  </f:function>Note that the <em>OrderManagementContext</em> class includes a helper method <em>ClearAndFillWithDemoData</em> to generate some demo data. The sample solution contains a helper command line tool <em>ODataFaq.DemoDataGenerator</em> that you can use to generate demo data. It assumes that you have localdb installed ( <em>Server=(localdb)\v11.0</em>) and it contains an empty sample database called <em>ODataFaq</em>.</p><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="WhyOData" name="WhyOData" class="mce-item-anchor"></a>Why OData and not just plain web API?</h2><p xmlns="http://www.w3.org/1999/xhtml">Today, only very few people still write two-tier applications where a client application (e.g. WPF) accesses a database (e.g. SQL Server) directly (e.g. using ADO.NET and <a href="http://en.wikipedia.org/wiki/Tabular_Data_Stream" target="_blank">TDS</a> in the background). Most applications consist of at least three tiers:</p><ol xmlns="http://www.w3.org/1999/xhtml">
  <li>Client application (e.g. Windows Store app, mobile app, browser app)</li>
  <li>Web services (e.g. REST services based on HTTP and JSON)</li>
  <li>Database (e.g. SQL Server)</li>
</ol><p xmlns="http://www.w3.org/1999/xhtml">In the good old days you might have used WCF to create web services. Today, most people prefer Microsoft’s <a href="http://www.asp.net/web-api" target="_blank">ASP.NET Web API</a> library. It makes it quite simple to create REST-based web services.</p><p xmlns="http://www.w3.org/1999/xhtml">Let’s think about how we would design a REST web service for maintaining our customers in the example shown above. We would likely offer a service to get all customers using HTTP GET at e.g. <em>http://localhost:12345/api/Customer</em>. The ASP.NET Web API code for this is really simple:</p>{% highlight javascript}public class CustomerWebApiController : ApiController&#xA;{&#xA;&#x9;[HttpGet]&#xA;&#x9;public IEnumerable&lt;customer&gt; Get()&#xA;&#x9;{&#xA;&#x9;&#x9;using (var context = new OrderManagementContext())&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return context.Customers.ToArray();&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight javascript }<p class="showcase" xmlns="http://www.w3.org/1999/xhtml">Note that the sample solution <a href="https://github.com/rstropek/Samples/tree/master/ODataFaq" target="_blank">in my GitHub repository</a> contains an OWin/Katana self-hosting command line program <em>ODataFaq.SelfHostService</em> that you can use to try and debug the web API. It also contains the code necessary to setup the web API routes. I will not include it in the blog post to keep the text clean. If you are interested in this aspect of the sample, please download the sample code.</p><p xmlns="http://www.w3.org/1999/xhtml">However, in practice that would not be sufficient. A client application will likely need to load a single customer, too. So we add a second API e.g. at <em>http://localhost:12345/api/Customer/&lt;customerid&gt;</em>:</p>{% highlight javascript}public class CustomerWebApiController : ApiController&#xA;{&#xA;&#x9;[...]&#xA;&#x9;[HttpGet]&#xA;&#x9;public Customer Get(Guid id)&#xA;&#x9;{&#xA;&#x9;&#x9;using (var context = new OrderManagementContext())&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return context.Customers&#xA;&#x9;&#x9;&#x9;&#x9;.SingleOrDefault(c =&gt; c.CustomerId == id);&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight javascript }<p xmlns="http://www.w3.org/1999/xhtml">Imagine your client application allows the user to filter customers by country. Of course it could use the <em>get all customers</em> service mentioned above and do the filtering on the client-side. This would be very inefficient. So we have to add a third service in order to let the database do the heavy lifting of filtering our customers. The service could life at e.g. <em>http://myserver/api/CustomerByCountry/&lt;countryisocode&gt;</em>.</p>{% highlight javascript}public class CustomerByCountryWebApiController : ApiController&#xA;{&#xA;&#x9;[HttpGet]&#xA;&#x9;public IEnumerable&lt;Customer&gt; Get(string countryIsoCode)&#xA;&#x9;{&#xA;&#x9;&#x9;using (var context = new OrderManagementContext())&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return context.Customers&#xA;&#x9;&#x9;&#x9;&#x9;.Where(c =&gt; c.CountryIsoCode == countryIsoCode)&#xA;&#x9;&#x9;&#x9;&#x9;.ToArray();&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight javascript }<p xmlns="http://www.w3.org/1999/xhtml">Now think about where this approach would lead us to in a more complex, real-world example. You would likely create dozens or even hundreds of different services to access your database via the web service layer. Each time the client application’s developer wants to add a feature that needs another kind of filtering or sorting, you need to extend and deploy the service layer. In practice, this is often not done. Generic data access functions like <em>get all customers</em> are used and people end up having performance problems because they do not use the database for what it is good at (efficient querying) and transfer an unnecessary large amount of data.</p><p xmlns="http://www.w3.org/1999/xhtml">Wouldn’t it be nice if we had a more generic web service? The approach shown above reminds me a bit of the "good" old times when I had been programming <a href="http://en.wikipedia.org/wiki/DBase" target="_blank">dBase</a> and <a href="http://en.wikipedia.org/wiki/Btrieve" target="_blank">BTrieve</a>. At that time, <a href="http://en.wikipedia.org/wiki/Select_(SQL)" target="_blank">SQL’s SELECT statement</a> was a huge step forward. Why not creating a single web service that accepts something like a SELECT statement? Well, OData does exactly that.</p><p xmlns="http://www.w3.org/1999/xhtml">Here is the code for adding an OData endpoint to our web API:</p>{% highlight javascript}[ODataRoutePrefix(&quot;Customer&quot;)]&#xA;public class CustomerController : ODataController&#xA;{&#xA;&#x9;private OrderManagementContext context = new OrderManagementContext();&#xA;&#x9;[EnableQuery]&#xA;&#x9;public IQueryable&lt;customer&gt; Get()&#xA;&#x9;{&#xA;&#x9;&#x9;return context.Customers;&#xA;&#x9;}&#xA;&#x9;protected override void Dispose(bool disposing)&#xA;&#x9;{&#xA;&#x9;&#x9;base.Dispose(disposing);&#xA;&#x9;&#x9;if (disposing)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;this.context.Dispose();&#xA;&#x9;&#x9;&#x9;GC.SuppressFinalize(this);&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight javascript }<p xmlns="http://www.w3.org/1999/xhtml">Note that return type of the <em>Get</em> method is not <em>IEnumerable</em> but <a href="http://msdn.microsoft.com/en-us/library/system.linq.iqueryable.ASPX" target="_blank"><em>IQueryable</em></a>. That enables queries to go all the way through to the underlying database ending up in a <em>WHERE</em> clause in the SQL SELECT statement.</p><p xmlns="http://www.w3.org/1999/xhtml">Let us look at some sample OData queries that can be sent to the OData endpoint shown above (note that my sample uses OData v4 so its new filter possibilities can be used):</p><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>
    <em>http://localhost:12345/odata/Customer</em> will give us a list of all customers.</li>
  <li>
    <em>http://localhost:12345/odata/Customer?$filter=CountryIsoCode eq 'AT'</em> returns all customers from Austria.</li>
  <li>
    <em>http://localhost:12345/odata/Customer?$expand=Orders</em> will join the <em>Customer</em> and the <em>OrderHeader</em> tables and return the nested result in a single request.</li>
  <li>
    <em>http://localhost:12345/odata/Customer?$select=CompanyName</em> will return only a single column per customer.</li>
  <li>
    <em>http://localhost:12345/odata/Customer?$filter=concat(CountryIsoCode,'!') eq 'AT!'</em> doesn’t make very much sense but demonstrates the use of built-in functions.</li>
</ul><p xmlns="http://www.w3.org/1999/xhtml">As you can see, a single OData endpoint acts as a generic web API for querying. Ok, it is not SELECT anymore. It is a different query language that fits perfectly into URLs and that is defined in the <a href="http://docs.oasis-open.org/odata/odata/v4.0/os/part2-url-conventions/odata-v4.0-os-part2-url-conventions.html" target="_blank">OData OASIS standard</a> (do check out this link if you want to learn more details about all the query options that OData supports).</p><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="Metadata" name="Metadata" class="mce-item-anchor"></a>What about metadata?</h2><p xmlns="http://www.w3.org/1999/xhtml">Imagine the web service developer and the client developer are not the same person. They might even be located in different organizations. How should the client developer know which web APIs are available? How should she know which fields e.g. a customer consists of? She will have to read the documentation (if there is one and if it is complete and if it is up to date ... - you know what I mean).</p><p xmlns="http://www.w3.org/1999/xhtml">Metadata is another thing that is great about OData. You will get it for free in a format that is called <a href="http://docs.oasis-open.org/odata/odata/v4.0/odata-v4.0-part3-csdl.html" target="_blank">CSDL</a>). You can consume it manually or use tools like Visual Studio to e.g. <a href="#GenerateClient">auto-generate proxy code</a> (in case you are using a typed language like C# or TypeScript).</p><p xmlns="http://www.w3.org/1999/xhtml">In the example shown above, you can ask for metadata using the URL <em>http://localhost:12345/odata/$metadata</em>:</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:8f551528-0fe6-4ee6-bdac-faa06d998b16" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="GenerateClient" name="GenerateClient" class="mce-item-anchor"></a>Can I generate C# proxy code for OData services?</h2><p xmlns="http://www.w3.org/1999/xhtml">Let’s use the metadata shown above to generate a C# proxy in a console application. For this, we use a <a href="http://visualstudiogallery.msdn.microsoft.com/9b786c0e-79d1-4a50-89a5-125e57475937" target="_blank">Visual Studio extension from Microsoft</a>. First, add an OData Client to your console application project:</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:012ef434-8a3c-4793-ba0e-5602600afc4b" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><p xmlns="http://www.w3.org/1999/xhtml">Next, enter your OData metadata URL and configure the client:</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:1420e992-7b7f-4ac8-af57-f723853984ba" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><p xmlns="http://www.w3.org/1999/xhtml">Build your program and you will get auto-generated proxy classes based on service metadata. You can now use Linq to query your OData service:</p>{% highlight javascript}class Program&#xA;{&#xA;&#x9;static void Main(string[] args)&#xA;&#x9;{&#xA;&#x9;&#x9;var container = new Container(&#xA;&#x9;&#x9;&#x9;new Uri(&quot;http://localhost:12345/odata/&quot;, UriKind.Absolute));&#xA;&#x9;&#x9;foreach (var c in container.Customer&#xA;&#x9;&#x9;&#x9;.Where(c =&gt; c.CountryIsoCode == &quot;AT&quot;))&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;Console.WriteLine(c.CompanyName);&#xA;&#x9;&#x9;}&#xA;&#x9;}&#xA;}{% endhighlight javascript }<h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="Functions" name="Functions" class="mce-item-anchor"></a>Is there something like stored procedures or functions to encapsulate logic?</h2><p xmlns="http://www.w3.org/1999/xhtml">Of course there is. You can define actions and functions. They can be unbound, bound to a single entity (e.g. customer), or bound to a collection (e.g. customers).</p><p xmlns="http://www.w3.org/1999/xhtml">Here is an example for a function that is bound to the <em>Customers</em> entity. It should return all customers that have bought at least one product from the category <em>BIKE</em>. This is a rather complex query and therefore it makes sense to encapsulate it in a function.</p>{% highlight javascript}[ODataRoutePrefix(&quot;Customer&quot;)]&#xA;public class CustomerController : ODataController&#xA;{&#xA;&#x9;[...]&#xA;&#x9;[EnableQuery]&#xA;&#x9;[ODataRoute(&quot;Default.OrderedBike&quot;)]&#xA;&#x9;[HttpGet]&#xA;&#x9;public IQueryable&lt;customer&gt; OrderedBike()&#xA;&#x9;{&#xA;&#x9;&#x9;return from c in this.context.Customers&#xA;&#x9;&#x9;&#x9;&#x9;where c.Orders.Count(o =&gt; o.OrderDetails.Count(od =&gt; od.Product.CategoryCode == &quot;BIKE&quot;) &gt; 0) &gt; 0&#xA;&#x9;&#x9;&#x9;&#x9;select c;&#xA;&#x9;}&#xA;}{% endhighlight javascript }<p xmlns="http://www.w3.org/1999/xhtml">You can access this function using the URL <em>http://myserver/odata/Customer/Default.OrderedBike()</em>. The database will handle the complex query with nested sub-selects.</p><p xmlns="http://www.w3.org/1999/xhtml">By the way, did you recognize that <em>OrderedBike</em> returns an <em>IQueryable</em>? Because of that, you can combine the function with additional OData query elements like <em>$filter</em>: <em>http://myserver/odata/Customer/Default.OrderedBike()?$filter=CountryIsoCode eq 'CH'</em>. In this example, the $filter clause is not executed on the client. It is combined with the function’s complex LINQ query so that SQL Server’s powerful query engine is used. The following screenshot shows the query logged by Visual Studio's IntelliTrace:</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:3b138a52-3117-4fd7-93e5-af0786c027ce" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><p xmlns="http://www.w3.org/1999/xhtml">
  <a href="http://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api/odata-v4/odata-actions-and-functions" target="_blank">Here</a> you can learn more about actions and functions in OData v4.</p><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="QueryOptions" name="QueryOptions" class="mce-item-anchor"></a>Can I restrict users so that they can only use certain query options?</h2><p xmlns="http://www.w3.org/1999/xhtml">This is possible, too. You can define which query options you want to support using the <em>EnableQuery</em> or <em>Queryable</em> attribute.</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:bec6a478-b81b-493c-9162-b4b5e459776a" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><p xmlns="http://www.w3.org/1999/xhtml">
  <a href="http://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api/odata-security-guidance" target="_blank">Here</a> you can learn more about OData security considerations.</p><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a href="#WCFDataServices"></a>How does ASP.NET Web API relate to WCF Data Services?</h2><p xmlns="http://www.w3.org/1999/xhtml">Before ASP.NET Web API learned to speak OData, Microsoft provided a library called <em>WCF Data Services</em> (aka <em>Astoria</em> As the name indicates, it is not based on the latest and greatest OWin/Katana technology stack. However, it is still maintained (e.g. see recently published <a href="http://blogs.msdn.com/b/odatateam/archive/2014/08/18/wcf-data-services-entity-framework-provider-is-updated-with-wcf-data-service-5-6-2.aspx" target="_blank">WCF Data Services EF Provider</a>).</p><p xmlns="http://www.w3.org/1999/xhtml">WCF Data Services uses OData v3 instead of v4. This needs not to be a disadvantage as many tools including Microsoft Office Excel and LinqPad do not support OData v4 yet.</p><p xmlns="http://www.w3.org/1999/xhtml">The beauty of WCF Data Services is that it makes it super simple to publish your entire Entity Framework model as an OData Feed with just two lines of code:</p>{% highlight javascript}public class ODataFaqService : EntityFrameworkDataService&lt;ordermanagementcontext&gt;&#xA;{&#xA;    public static void InitializeService(DataServiceConfiguration config)&#xA;    {&#xA;&#x9;&#x9;config.SetEntitySetAccessRule(&quot;*&quot;, EntitySetRights.AllRead);&#xA;        config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V3;&#xA;    }&#xA;}{% endhighlight javascript }<p xmlns="http://www.w3.org/1999/xhtml">Just like ASP.NET Web API, WCF Data Services offers many options for securing and extending (e.g. with <a href="http://msdn.microsoft.com/en-us/library/dd744842(v=vs.110).aspx" target="_blank">Interceptors</a>) your OData services. <a href="http://msdn.microsoft.com/en-us/library/dd728284(v=vs.110).aspx" target="_blank">Here</a> you can learn more about it if you are interested.</p><p xmlns="http://www.w3.org/1999/xhtml">You can use Excel to try the OData service:</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:8c8cd0d6-687b-43ad-9920-0e547ad64e43" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><p xmlns="http://www.w3.org/1999/xhtml">You can also try LinqPad:</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:5b0cb5b3-35fb-460e-a807-acf936633ed0" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><p xmlns="http://www.w3.org/1999/xhtml">So when should you use ASP.NET Web API’s OData endpoint and when to go for WCF Data Services? Here is my personal opinion:</p><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>If you have a large, complex entity framework project and you need to make it available for a client application that is under your control, WCF Data Services is still a valid option.</li>
  <li>If you want to develop a public OData service and you want to fine-tune and control it in detail, I would recommend using ASP.NET Web API.</li>
  <li>If you start a new project and you don't know which one to choose, I would tend to ASP.NET Web API as it builds on OWin/Katana which enables a lot of interesting scenarios (e.g. run it on an offline-enabled client).</li>
</ul><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="ODataLib" name="ODataLib" class="mce-item-anchor"></a>Can I still use OData if I don't use Entity Framework?</h2><p xmlns="http://www.w3.org/1999/xhtml">Of course you can. If you have a data source that supports <em>IQueryable</em>, adding an OData endpoint should not be a big problem. Without that, you can still build an OData service but it will be much more work.</p><p xmlns="http://www.w3.org/1999/xhtml">The basis of Microsoft's OData implementation is the <em>ODataLib</em>. You can the corresponding NuGet package at <a href="https://www.nuget.org/packages/Microsoft.OData.Core/" target="_blank">https://www.nuget.org/packages/Microsoft.OData.Core/</a>. It contains classes to manually build OData's <em>Entity Data Model</em> (EDM), to parse OData query strings, etc. You can build on this and add your own custom backend.</p><p class="showcase" xmlns="http://www.w3.org/1999/xhtml">The <a href="http://help.timecockpit.com/?topic=html/5d6e34c5-3b08-4fa4-baa0-45eb707b6b78.htm" target="_blank">OData endpoint</a> for our own product <a href="https://www.timecockpit.com" target="_blank">time cockpit</a> has been built like that. We do not use Entity Framework as we offer a completely customizable data model. You can add tables, columns, relations, validation rules, etc. at runtime. Therefore we cannot make use of design-time code generation and compilation. We used the <em>ODataLib</em> to translate OData requests into requests to our own data access layer and back.</p><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="Support" name="Support" class="mce-item-anchor"></a>Is OData already supported by major tool vendors?</h2><p xmlns="http://www.w3.org/1999/xhtml">The popularity of OData has been rising in the last few years remarkably. The driving forces behind the OData OASIS standard are Microsoft and SAP. Both companies support OData in many of their products (e.g. SharePoint, <a href="http://azure.microsoft.com" target="_blank">Microsoft Azure</a>, etc.).</p><p xmlns="http://www.w3.org/1999/xhtml">Many BI tools support OData sources already. This also includes Microsoft's Excel-based Power BI tools. I included a screenshot of Excel accessing an OData feed <a href="#WCFDataServices">above</a>. PragmatiQa's <a href="http://pragmatiqa.com/xodata/" target="_blank">XOData</a> tool also demonstrates why having a standard is so important: People can write generic tools, in this case a generic query builder, that can work with numerous different source systems.</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:ce63de65-ec8d-416f-adea-f5c976b3862f" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><p class="showcase" xmlns="http://www.w3.org/1999/xhtml">In our own software <a href="https://www.timecockpit.com" target="_blank">time cockpit</a>, we also offer a <a href="http://help.timecockpit.com/?topic=html/5d6e34c5-3b08-4fa4-baa0-45eb707b6b78.htm" target="_blank">read- and write-enabled OData endpoint</a>. Our customers use it for reporting purposes, for writing time cockpit add-ons, and for automating routine tasks (e.g. scheduled checking for projects with budget overrun).</p><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="Writing" name="Writing" class="mce-item-anchor"></a>Is OData just for reading data?</h2><p xmlns="http://www.w3.org/1999/xhtml">No, it fully supports changing data (insert, delete, replace, merge), too. You can even group multiple operations in so called <em>batches</em> and make the server run them in the context of a DB transaction. However, you are not forced to allow changing data. If you just want to publish a read-only endpoint for your users for e.g. reporting purposes, that is fine, too.</p><p xmlns="http://www.w3.org/1999/xhtml">The interesting thing about OData is that it does also standardize the serialization format of data. Data types, representation of relations, nested objects, etc. are well defined. Additionally, the OData's metadata format is extensible so you can add your own annotations.</p><p xmlns="http://www.w3.org/1999/xhtml">Here you see the sample implementation that enables inserting of new customers in our ASP.NET Web API OData implementation:</p>{% highlight javascript}[HttpPost]&#xA;public async Task&lt;ihttpactionresult&gt; Post([FromBody] Customer customer)&#xA;{&#xA;&#x9;context.Customers.Add(customer);&#xA;&#x9;await context.SaveChangesAsync();&#xA;&#x9;return Created(customer);&#xA;}{% endhighlight javascript }<p xmlns="http://www.w3.org/1999/xhtml">In WCF Data Services it is even simpler to enable inserting customers:</p>{% highlight javascript}public class ODataFaqService : EntityFrameworkDataService&lt;ordermanagementcontext&gt;&#xA;{&#xA;    public static void InitializeService(DataServiceConfiguration config)&#xA;    {&#xA;&#x9;&#x9;config.SetEntitySetAccessRule(&quot;*&quot;, EntitySetRights.AllRead);&#xA;&#x9;&#x9;// Add the following line to enable writing new customers&#xA;&#x9;&#x9;config.SetEntitySetAccessRule(&quot;Customers&quot;, EntitySetRights.AllRead | EntitySetRights.WriteAppend);&#xA;        config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V3;&#xA;    }&#xA;}{% endhighlight javascript }<p xmlns="http://www.w3.org/1999/xhtml">Here you see how we can now add a new customers using the <a href="http://www.telerik.com/fiddler" target="_blank">Fiddler</a>:</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:820be6f2-c68d-4cb1-947d-c3307ac777c9" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><h2 xmlns="http://www.w3.org/1999/xhtml">
  <a id="Auth" name="Auth" class="mce-item-anchor"></a>What about authentication and authorization?</h2><p xmlns="http://www.w3.org/1999/xhtml">OData does not cover authentication or authorization. However, it is a REST web service and therefore you can use existing standards from that domain for auth (e.g. <a href="http://en.wikipedia.org/wiki/Basic_access_authentication" target="_blank">basic auth</a>, <a href="http://tools.ietf.org/html/rfc6750" target="_blank">bearer tokens</a>, <a href="http://tools.ietf.org/html/rfc6749" target="_blank">OAuth2</a>, <a href="http://openid.net/connect/" target="_blank">Open ID Connect</a>, etc.).</p><p xmlns="http://www.w3.org/1999/xhtml">In my example I want to demonstrate how to do authorization using the <a href="http://oauth.net/2/" target="_blank">OAuth2</a> protocol with its <em>Resource Owner Password Credentials Grant</em> flow. With that, accessing the OData service is a two-step process:</p><ol xmlns="http://www.w3.org/1999/xhtml">
  <li>First, you need to get a token by presenting username and password.</li>
  <li>Next, you need to sent the token in the <em>Authorization</em> header of subsequent OData requests.</li>
</ol><p xmlns="http://www.w3.org/1999/xhtml">Microsoft offers a ready-made OAuth2 middleware for OWin/Katana. I will use it and add a very simple password validation logic (username and password simply have to match). Additionally, I add an <em>IsAdmin</em> claim if the username is <em>admin</em>. Your implementation would probably contain a more sophisticated logic with additional claims.</p>{% highlight javascript}private static void SetupOauthServer(IAppBuilder app)&#xA;{&#xA;&#x9;app.UseOAuthAuthorizationServer(new OAuthAuthorizationServerOptions&#xA;&#x9;{&#xA;&#x9;&#x9;AllowInsecureHttp = true,&#xA;&#x9;&#x9;TokenEndpointPath = new PathString(&quot;/token&quot;),&#xA;&#x9;&#x9;AccessTokenExpireTimeSpan = TimeSpan.FromHours(8),&#xA;&#x9;&#x9;Provider = new DummyAuthorizationProvider()&#xA;&#x9;});&#xA;&#x9;app.UseOAuthBearerAuthentication(new OAuthBearerAuthenticationOptions());&#xA;}&#xA;private class DummyAuthorizationProvider : OAuthAuthorizationServerProvider&#xA;{&#xA;&#x9;public static Task FinishedTask = Task.FromResult(0);&#xA;&#x9;public override Task ValidateClientAuthentication(OAuthValidateClientAuthenticationContext context)&#xA;&#x9;{&#xA;&#x9;&#x9;// No validation code -&gt; all clients are ok&#xA;&#x9;&#x9;context.Validated();&#xA;&#x9;&#x9;return FinishedTask;&#xA;&#x9;}&#xA;&#x9;public override Task GrantResourceOwnerCredentials(OAuthGrantResourceOwnerCredentialsContext context)&#xA;&#x9;{&#xA;&#x9;&#x9;// If username and password are equal, they are ok&#xA;&#x9;&#x9;if (context.UserName != context.Password)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;context.Rejected();&#xA;&#x9;&#x9;&#x9;return FinishedTask;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;// Build claims identity&#xA;&#x9;&#x9;var identity = new ClaimsIdentity(&quot;OAuth2&quot;);&#xA;&#x9;&#x9;identity.AddClaim(new Claim(&quot;User&quot;, context.UserName));&#xA;&#x9;&#x9;if (context.UserName == &quot;admin&quot;)&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;identity.AddClaim(new Claim(&quot;IsAdmin&quot;, &quot;IsAdmin&quot;));&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;context.Validated(identity);&#xA;&#x9;&#x9;return FinishedTask;&#xA;&#x9;}&#xA;}{% endhighlight javascript }<p xmlns="http://www.w3.org/1999/xhtml">Now we can protect our OData API using the <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.authorizeattribute(v=vs.118).aspx" target="_blank"><em>Authorize</em></a> attribute or in code by manually inspecting the claims of the user:</p>{% highlight javascript}[Authorize]&#xA;[ODataRoutePrefix(&quot;Customer&quot;)]&#xA;public class CustomerController : ODataController&#xA;{&#xA;&#x9;[...]&#xA;&#x9;[EnableQuery]&#xA;&#x9;public IHttpActionResult Get()&#xA;&#x9;{&#xA;&#x9;&#x9;if (!string.IsNullOrWhiteSpace(((ClaimsPrincipal)Thread.CurrentPrincipal).Claims.FirstOrDefault(c =&gt; c.Type == &quot;IsAdmin&quot;).Value))&#xA;&#x9;&#x9;{&#xA;&#x9;&#x9;&#x9;return Ok(context.Customers);&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;return Unauthorized();&#xA;&#x9;}&#xA;&#x9;&#xA;&#x9;[...]&#xA;}{% endhighlight javascript }<p xmlns="http://www.w3.org/1999/xhtml">If we try to access our OData service now without a token, we get an <em>Unauthorized</em> error. We have to acquire a token first.</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:a2eae4d3-b36a-457b-98fb-d1795384b24e" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function><p xmlns="http://www.w3.org/1999/xhtml">Once we received the token, we can pass it to subsequent OData requests:</p><f:function name="Composite.Media.ImageGallery.Slimbox2" xmlns:f="http://www.composite.net/ns/function/1.0">
  <f:param name="MediaImage" value="MediaArchive:27c503e6-e430-4977-8b49-a9d7f81d3e9d" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxWidth" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ThumbnailMaxHeight" value="800" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxWidth" value="1280" xmlns:f="http://www.composite.net/ns/function/1.0" />
  <f:param name="ImageMaxHeight" value="1024" xmlns:f="http://www.composite.net/ns/function/1.0" />
</f:function>