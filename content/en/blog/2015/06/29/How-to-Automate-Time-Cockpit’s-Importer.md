---
layout: blog
title: How to Automate Time Cockpit’s Importer
teaser: If you want to import a single Excel or CSV file, time cockpit's Importer Module probably offers exactly what you need. However, you might need to regularly import multiple files depending on each other (e.g. projects and customers where each project row contains a reference to a customer row). Wouldn't it be nice to have this import automated so you can trigger it with a single click? This is possible using time cockpit's scripting language.
author: Michael Kubitschka
date: 2015-25-29
bannerimage: /content/images/blog/2015/06/start-auto-import.jpg
permalink: /blog/2015/06/29/How-to-Automate-Time-Cockpit’s-Importer
---

<p xmlns="http://www.w3.org/1999/xhtml">
  <img src="{{site.baseurl}}/content/images/blog/2015/06/start-auto-import.jpg" />
</p><p xmlns="http://www.w3.org/1999/xhtml">If you want to import a single Excel or CSV file, <a href="https://help.timecockpit.com/html/ee560e49-e503-4d80-9167-2e6533f50dbe.htm" target="_blank">time cockpit's Importer Module</a> probably offers exactly what you need. However, you might need to regularly import multiple files depending on each other (e.g. <em>projects</em> and <em>customers</em> where each project row contains a reference to a customer row). Wouldn't it be nice to have this import automated so you can trigger it with a single click? This is possible using time cockpit's <a href="https://help.timecockpit.com/?topic=html/c20d94e9-97dc-48a8-9171-fd3bb70dad86.htm" target="_blank">scripting language</a>.</p><h2 xmlns="http://www.w3.org/1999/xhtml">Typical Import Challenges</h2><p xmlns="http://www.w3.org/1999/xhtml">Many of our customers use time cockpit Importer to periodically import master data like customers, projects, tasks, etc. from several different upstream systems. However, if you need to import your data regularly, this can become a tedious task. Typical challenges are:</p><ul xmlns="http://www.w3.org/1999/xhtml">
  <li>Users are not aware of data dependencies that enforce a certain order of importing files (e.g. <em>projects</em> and <em>customers</em> where each project row contains a reference to a customer row)</li>
  <li>Users cannot remember storage locations (e.g. file server) where upstream systems store files</li>
  <li>Users run imports seldom. Therefore they forget how to start it.</li>
</ul><h2 xmlns="http://www.w3.org/1999/xhtml">Automate the Import</h2><p xmlns="http://www.w3.org/1999/xhtml">You can automate imports using <em>Actions</em> written in time cockpit scripting language (Python). Such actions can be triggered manually or periodically. The import action has to call time cockpit's Import Module and trigger the corresponding <a href="https://help.timecockpit.com/?topic=html/ee560e49-e503-4d80-9167-2e6533f50dbe.htm" target="_blank"><em>Import Definition</em></a>. It contains all the information that time cockpit needs to read the source file, map it to you data structure in time cockpit and write the data to your time cockpit database.</p><p xmlns="http://www.w3.org/1999/xhtml">We want to share sample code for such an action so it becomes easier for you to automate your own import process. Here is the sample code:</p><h2 xmlns="http://www.w3.org/1999/xhtml">
  {% highlight javascript}clr.AddReference(&quot;System&quot;)&#xD;&#xA;clr.AddReference(&quot;TimeCockpit.Data.Import&quot;)&#xD;&#xA;from System.Text import Encoding&#xD;&#xA;from System.IO import File&#xD;&#xA;from TimeCockpit.Data.Import import *&#xD;&#xA;&#xD;&#xA;def actionSample(actionContext):&#xD;&#xA;&#xD;&#xA;&#x9;# implementation of event handler&#xD;&#xA;&#x9;def printMessage(source, worksheet, row, severity, message):&#xD;&#xA;&#x9;&#x9;# e.g. error handling, abort action ...&#xD;&#xA;&#x9;&#x9;print(message)&#xD;&#xA;&#xD;&#xA;&#x9;def printProgress(s, ws, max, current, created, updated):&#xD;&#xA;&#x9;&#x9;print ws, current, max&#xD;&#xA;&#xD;&#xA;&#x9;def printFinished(source, reportDataArray, reportMimeType, sourceDataArray, sourceMimeType):&#xD;&#xA;&#x9;&#x9;print 'Finished importing...'&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#x9;def performImport(impDefName, importFilePath):&#x9;&#xD;&#xA;&#x9;&#x9;sourceData = File.ReadAllBytes(importFilePath)&#xD;&#xA;&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;# check existence of the import definition&#xD;&#xA;&#x9;&#x9;impDef = Context.SelectSingleWithParams({ &#xD;&#xA;&#x9;&#x9;&quot;Query&quot; : &quot;From I In ImportDefinition Where I.ImportDefinitionName = @DefName Select I&quot;, &#xD;&#xA;&#x9;&#x9;&quot;@DefName&quot; : impDefName })&#xD;&#xA;&#x9;&#x9;if impDef == None:&#xD;&#xA;&#x9;&#x9;&#x9;raise ValidationException(&quot;The import definition &quot; + impDefName + &quot; could not be found.&quot;)&#x9;&#xD;&#xA;&#x9;&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;importTaskId = Guid.NewGuid()&#xD;&#xA;&#x9;&#x9;definition = ImportBookDefinition.ReadXaml(Encoding.UTF8.GetString(impDef.APP_Definition))&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;engine = ImportEngineFactory.Create(ImportEngineFactory.XlsxEngine, Context)&#x9;&#xD;&#xA;&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;# attach event handlers&#xD;&#xA;&#x9;&#x9;engine.OnMessage += printMessage&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;engine.OnProgress += printProgress&#xD;&#xA;&#x9;&#x9;engine.OnReportFinished += printFinished&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;&#xD;&#xA;&#x9;&#x9;engine.PerformImport(definition, True, sourceData, impDefName, importTaskId, impDef.ObjectUuid, None)&#xD;&#xA;&#xD;&#xA;&#x9;# names of your previous created import definitions in the module &quot;Management&quot; in the section &quot;Settings/Import Definitions&quot;&#xD;&#xA;&#x9;importDefCust = 'Auto-Import-Customers'&#xD;&#xA;&#x9;importDefP = 'Auto-Import-Projects'&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;# call imports in certain order&#xD;&#xA;&#x9;performImport(importDefCust, '''C:\Documents\ImportContent\customerImport.xlsx''')&#xD;&#xA;&#x9;performImport(importDefP, '''C:\Documents\ImportContent\projectImport.xlsx'''){% endhighlight %}How The Code Works</h2><p xmlns="http://www.w3.org/1999/xhtml">The method <code>performImport</code> contains the important part of the action.</p><ol xmlns="http://www.w3.org/1999/xhtml">
  <li>First, we read the content of the file that should be imported with <code class="python functions">File</code><code class="python plain">.ReadAllBytes</code>.</li>
  <li>Next, we load the import definition into the local variable <code>definition</code>. The import definition defines how to map the columns in the Excel or CSV file to the corresponding time cockpit data structure.</li>
  <li>Next, we create an <code>ImportEngineFactory</code>. It contains the core import logic of time cockpit.</li>
  <li>Lastly, <code>PerformImport</code> loads the data from the Excel or CSV file and writes it into time cockpit.</li>
</ol><h2 xmlns="http://www.w3.org/1999/xhtml">Benefits of Automated Imports</h2><p xmlns="http://www.w3.org/1999/xhtml">
  <strong>Always in the correct sequence</strong>
  <br /> You can automate the proper sequence of your imports (e.g. first customers then projects because each project refers to a customer).</p><p xmlns="http://www.w3.org/1999/xhtml">
  <strong>Automatically generated import logs</strong>
  <br />The results of the imports can be found in the usual import log of time cockpit's Import Module.</p><p xmlns="http://www.w3.org/1999/xhtml">
  <img title="Import Logs" src="{{site.baseurl}}/content/images/blog/2015/05/ImportLogs.png" alt="Import Logs" />
</p><p xmlns="http://www.w3.org/1999/xhtml">
  <strong>Manual or periodic execution</strong>
  <br />The action can be executed manually in time cockpit. It can also be automated by using our <a href="https://help.timecockpit.com/html/7c78b76a-2526-4408-accc-ccae19bbca45.htm" target="_blank"><em>Execute Script Tool</em></a>. </p><h2 xmlns="http://www.w3.org/1999/xhtml">Alternative: RESTful OData Web Services</h2><p xmlns="http://www.w3.org/1999/xhtml">If you want to schedule the importer process in the cloud instead of your own data center, you can use time cockpit's <a href="https://help.timecockpit.com/?topic=html/5d6e34c5-3b08-4fa4-baa0-45eb707b6b78.htm">OData web service API</a> e.g. in combination with an <a href="http://www.hanselman.com/blog/IntroducingWindowsAzureWebJobs.aspx">Azure WebJob</a> instead. This requires that the source system provides data via a RESTful API or database read access. Our blog article <em><a href="http://www.timecockpit.com/blog/2015/05/18/Integrating-On-Premise-Resources-Into-Time-Cockpit-" target="_blank">Integrating On-Premise Resources Into Time Cockpit</a></em> contains detailed information about that approach.</p>